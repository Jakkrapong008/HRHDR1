<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®‡∏Å‡∏≤‡∏£‡∏°‡∏≤‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #fff5f5;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .tab {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .tab::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background-color: #f56565;
            transition: width 0.3s ease;
        }
        
        .tab.active::after {
            width: 100%;
        }
        
        .tab.active {
            color: #e53e3e;
            font-weight: 600;
        }
        
        table {
            border-collapse: collapse;
            width: 100%;
        }
        
        th, td {
            border: 1px solid #e2e8f0;
            padding: 8px 12px;
            text-align: center;
        }
        
        th {
            background-color: #fed7d7;
            color: #742a2a;
        }
        
        tr:nth-child(even) {
            background-color: #fff;
        }
        
        tr:nth-child(odd) {
            background-color: #fef2f2;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #e53e3e;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Styles for custom message box */
        .message-box-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
        }

        .message-box-content {
            background-color: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
            max-width: 24rem;
            width: 100%;
            text-align: center;
        }

        .message-box-text {
            font-size: 1.125rem; /* text-lg */
            font-weight: 600; /* font-semibold */
            margin-bottom: 1rem;
        }

        .message-box-close-btn {
            background-color: #ef4444; /* bg-red-500 */
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem; /* rounded-md */
            transition: background-color 0.15s ease-in-out;
        }

        .message-box-close-btn:hover {
            background-color: #dc2626; /* hover:bg-red-600 */
        }
    </style>
</head>
<body>
    <div class="min-h-screen flex flex-col">
        <header class="bg-white shadow-md py-6">
            <div class="container mx-auto px-4">
                <h1 class="text-3xl font-bold text-red-600 text-center">
                    üìä ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®‡∏Å‡∏≤‡∏£‡∏°‡∏≤‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô
                </h1>
                <h2 class="text-2xl font-bold text-red-500 text-center mt-2">
                    ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ì‡∏∞‡∏Ñ‡∏£‡∏π‡πÅ‡∏•‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤
                </h2>
                <p class="text-gray-600 text-center mt-1">
                    üè´ ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏´‡∏≤‡∏á‡∏î‡∏á‡∏£‡∏±‡∏ê‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏≠‡∏∏‡∏õ‡∏ñ‡∏±‡∏°‡∏†‡πå ‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ 2568
                </p>
            </div>
        </header>

        <main class="flex-grow container mx-auto px-4 py-8">
            <div class="flex flex-wrap border-b border-gray-200 mb-6">
                <button id="tab1" class="tab active px-4 py-2 mr-2 mb-2" onclick="switchTab(1)">
                    üìà ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô
                </button>
                <button id="tab2" class="tab px-4 py-2 mr-2 mb-2" onclick="switchTab(2)">
                    üìã ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô
                </button>
                <button id="tab3" class="tab px-4 py-2 mb-2" onclick="switchTab(3)">
                    üë§ ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•
                </button>
            </div>

            <div id="tabContent1" class="tab-content active">
                <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                    <h3 class="text-xl font-semibold text-red-600 mb-4">
                        üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
                    </h3>
                    <div class="mb-6">
                        <input type="date" id="dateSelector" class="w-full md:w-64 px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-300">
                    </div>
                    
                    <div id="dailyStatsLoader" class="loader"></div>
                    
                    <div id="dailyStatsContent" class="hidden">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <div class="chart-container">
                                    <canvas id="dailyChart"></canvas>
                                </div>
                            </div>
                            <div>
                                <h4 class="text-lg font-medium text-gray-800 mb-3">
                                    ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô
                                </h4>
                                <div class="bg-red-50 rounded-lg p-4">
                                    <div class="grid grid-cols-2 gap-4">
                                        <div class="flex items-center">
                                            <span class="w-3 h-3 rounded-full bg-green-500 mr-2"></span>
                                            <span>‡∏°‡∏≤: </span>
                                            <span id="presentCount" class="font-semibold ml-1">0</span>
                                        </div>
                                        <div class="flex items-center">
                                            <span class="w-3 h-3 rounded-full bg-yellow-500 mr-2"></span>
                                            <span>‡∏™‡∏≤‡∏¢: </span>
                                            <span id="lateCount" class="font-semibold ml-1">0</span>
                                        </div>
                                        <div class="flex items-center">
                                            <span class="w-3 h-3 rounded-full bg-blue-500 mr-2"></span>
                                            <span>‡∏•‡∏≤‡∏Å‡∏¥‡∏à: </span>
                                            <span id="personalLeaveCount" class="font-semibold ml-1">0</span>
                                        </div>
                                        <div class="flex items-center">
                                            <span class="w-3 h-3 rounded-full bg-purple-500 mr-2"></span>
                                            <span>‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢: </span>
                                            <span id="sickLeaveCount" class="font-semibold ml-1">0</span>
                                        </div>
                                        <div class="flex items-center">
                                            <span class="w-3 h-3 rounded-full bg-red-500 mr-2"></span>
                                            <span>‡∏Ç‡∏≤‡∏î: </span>
                                            <span id="absentCount" class="font-semibold ml-1">0</span>
                                        </div>
                                        <div class="flex items-center">
                                            <span class="w-3 h-3 rounded-full bg-orange-500 mr-2"></span>
                                            <span>‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£: </span>
                                            <span id="officialCount" class="font-semibold ml-1">0</span>
                                        </div>
                                    </div>
                                    <div class="mt-4 pt-3 border-t border-red-200">
                                        <div class="flex items-center justify-between">
                                            <span class="font-medium">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>
                                            <span id="totalCount" class="font-semibold text-red-600">0</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-8 pt-6 border-t border-gray-200">
                            <h4 class="text-lg font-medium text-gray-800 mb-3">
                                üîê ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                            </h4>
                            <div class="flex flex-col md:flex-row gap-4 mb-4">
                                <input type="password" id="adminCodeInput" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠" 
                                    class="flex-grow px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-300">
                                <button id="checkAdminCodeBtn" class="bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-md transition-colors">
                                    ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
                                </button>
                            </div>
                            
                            <div id="adminContentArea" class="hidden mt-4">
                                <div class="bg-red-50 rounded-lg p-4 mb-4">
                                    <h5 class="font-medium text-red-700 mb-2">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥</h5>
                                    <p class="text-sm text-gray-600 mb-3">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: <span id="selectedDateDisplay">-</span></p>
                                    
                                    <div class="overflow-x-auto">
                                        <table class="min-w-full">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                                                    <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                                </tr>
                                            </thead>
                                            <tbody id="specialStatusTableBody">
                                                </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="tabContent2" class="tab-content">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-semibold text-red-600 mb-4">
                        üìä ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô
                    </h3>
                    
                    <div id="dailyTableLoader" class="loader"></div>
                    
                    <div id="dailyTableContent" class="hidden overflow-x-auto">
                        <table class="min-w-full">
                            <thead>
                                <tr>
                                    <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                    <th>‡∏°‡∏≤</th>
                                    <th>‡∏™‡∏≤‡∏¢</th>
                                    <th>‡∏•‡∏≤‡∏Å‡∏¥‡∏à</th>
                                    <th>‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢</th>
                                    <th>‡∏Ç‡∏≤‡∏î</th>
                                    <th>‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</th>
                                    <th>‡∏£‡∏ß‡∏°</th>
                                </tr>
                            </thead>
                            <tbody id="dailyTableBody">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="tabContent3" class="tab-content">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-semibold text-red-600 mb-4">
                        üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•
                    </h3>
                    
                    <div class="mb-6">
                        <div class="flex flex-col md:flex-row gap-4 mb-4">
                            <input type="text" id="staffIdInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢ ID ‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£" 
                                class="flex-grow px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-300">
                            <button id="searchStaffIdBtn" class="bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-md transition-colors">
                                ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ID
                            </button>
                        </div>
                    </div>
                    
                    <div id="staffIdLoader" class="loader hidden"></div>
                    
                    <div id="staffNotFound" class="hidden bg-yellow-50 border border-yellow-200 text-yellow-800 p-4 rounded-md">
                        ‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏ï‡∏≤‡∏° ID ‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                    </div>
                    
                    <div id="staffInfoContent" class="hidden">
                        <div class="bg-red-50 rounded-lg p-4 mb-6">
                            <h4 class="text-lg font-medium text-gray-800">
                                ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£
                            </h4>
                            <div class="mt-2">
                                <p><span class="font-medium">ID:</span> <span id="staffId"></span></p>
                                <p><span class="font-medium">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•:</span> <span id="staffName"></span></p>
                            </div>
                        </div>
                        
                        <div class="mb-6 bg-white p-4 rounded-lg shadow-sm border border-gray-200">
                            <h4 class="text-lg font-medium text-gray-800 mb-3">
                                üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</label>
                                    <input type="date" id="startDateSelector" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-300">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
                                    <input type="date" id="endDateSelector" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-300">
                                </div>
                            </div>
                            <button id="searchDateRangeBtn" class="w-full md:w-auto bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-md transition-colors">
                                ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                            </button>
                        </div>
                    </div>
                    
                    <div id="staffStatsLoader" class="loader hidden"></div>
                    
                    <div id="staffStatsContent" class="hidden">
                        <h4 class="text-lg font-medium text-gray-800 mb-3">
                            ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏°‡∏≤‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô
                        </h4>
                        <p class="text-sm text-gray-600 mb-3">
                            ‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: <span id="dateRangeDisplay">-</span>
                        </p>
                        
                        <div class="overflow-x-auto">
                            <table class="min-w-full">
                                <thead>
                                    <tr>
                                        <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                    </tr>
                                </thead>
                                <tbody id="staffTableBody">
                                    </tbody>
                            </table>
                        </div>
                        
                        <div class="mt-6 bg-red-50 rounded-lg p-4">
                            <h4 class="text-lg font-medium text-gray-800 mb-3">
                                ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
                            </h4>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                                <div class="bg-white p-3 rounded-md shadow-sm">
                                    <div class="text-green-600 font-medium">‡∏°‡∏≤</div>
                                    <div id="staffPresentCount" class="text-2xl font-bold">0</div>
                                </div>
                                <div class="bg-white p-3 rounded-md shadow-sm">
                                    <div class="text-yellow-600 font-medium">‡∏™‡∏≤‡∏¢</div>
                                    <div id="staffLateCount" class="text-2xl font-bold">0</div>
                                </div>
                                <div class="bg-white p-3 rounded-md shadow-sm">
                                    <div class="text-blue-600 font-medium">‡∏•‡∏≤‡∏Å‡∏¥‡∏à</div>
                                    <div id="staffPersonalLeaveCount" class="text-2xl font-bold">0</div>
                                </div>
                                <div class="bg-white p-3 rounded-md shadow-sm">
                                    <div class="text-purple-600 font-medium">‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢</div>
                                    <div id="staffSickLeaveCount" class="text-2xl font-bold">0</div>
                                </div>
                                <div class="bg-white p-3 rounded-md shadow-sm">
                                    <div class="text-red-600 font-medium">‡∏Ç‡∏≤‡∏î</div>
                                    <div id="staffAbsentCount" class="text-2xl font-bold">0</div>
                                </div>
                                <div class="bg-white p-3 rounded-md shadow-sm">
                                    <div class="text-orange-600 font-medium">‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</div>
                                    <div id="staffOfficialCount" class="text-2xl font-bold">0</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <footer class="bg-white py-6 border-t border-gray-200">
            <div class="container mx-auto px-4 text-center text-gray-600">
                <p>üë®‚Äçüíª ‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÇ‡∏î‡∏¢ ‡∏ô‡∏≤‡∏¢‡∏à‡∏±‡∏Å‡∏£‡∏û‡∏á‡∏®‡πå ‡∏à‡∏±‡∏ô‡∏ó‡∏ß‡∏á‡∏®‡πå ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏´‡∏≤‡∏á‡∏î‡∏á‡∏£‡∏±‡∏ê‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏≠‡∏∏‡∏õ‡∏ñ‡∏±‡∏°‡∏†‡πå</p>
            </div>
        </footer>
    </div>

    <script>
        // Global variables
        const API_URL = 'https://script.google.com/macros/s/AKfycbz1klz1YOuaUHIIvH1pLc5YnJIGMftoHw5IVdcbhT4Ec2uBxFlgiW_GtM4mCcp8X7kbxQ/exec';
        const SHEET_ID = '1VIQGoMbpIwLAwhX3yv6t_4ybi7VqY4Ktbf-3ot0Bm-A';
        const SHEET_NAME = '102'; // Assuming this sheet name is correct based on the original code
        const ADMIN_CODE = '112233'; // ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏©
        
        let allData = [];
        let dailyChart = null;
        let currentSelectedDate = null;
        let currentStaffRowIndex = -1;
        let allDates = [];
        
        // Status color mapping
        const statusColors = {
            '‡∏°‡∏≤': 'bg-green-100 text-green-800',
            '‡∏™‡∏≤‡∏¢': 'bg-yellow-100 text-yellow-800',
            '‡∏•‡∏≤‡∏Å‡∏¥‡∏à': 'bg-blue-100 text-blue-800',
            '‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢': 'bg-purple-100 text-purple-800',
            '‡∏Ç‡∏≤‡∏î': 'bg-red-100 text-red-800',
            '‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£': 'bg-orange-100 text-orange-800'
        };
        
        const chartColors = [
            'rgba(34, 197, 94, 0.8)',  // ‡∏°‡∏≤ - green
            'rgba(234, 179, 8, 0.8)',   // ‡∏™‡∏≤‡∏¢ - yellow
            'rgba(59, 130, 246, 0.8)',  // ‡∏•‡∏≤‡∏Å‡∏¥‡∏à - blue
            'rgba(168, 85, 247, 0.8)',  // ‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢ - purple
            'rgba(239, 68, 68, 0.8)',   // ‡∏Ç‡∏≤‡∏î - red
            'rgba(249, 115, 22, 0.8)'   // ‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£ - orange
        ];

        // Helper function to normalize date to YYYY-MM-DD string
        // This ensures consistent date format for comparisons, regardless of input variations.
        function normalizeDateString(dateInput) {
            if (!dateInput) return null;
            const date = new Date(dateInput);
            if (isNaN(date.getTime())) {
                return null; // Return null for invalid dates
            }
            // Get YYYY-MM-DD in local time
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            fetchData();
            
            // Add event listeners
            document.getElementById('dateSelector').addEventListener('change', handleDateSelection);
            document.getElementById('searchStaffIdBtn').addEventListener('click', searchStaffId);
            document.getElementById('staffIdInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchStaffId();
                }
            });
            document.getElementById('searchDateRangeBtn').addEventListener('click', searchDateRange);
            document.getElementById('checkAdminCodeBtn').addEventListener('click', checkAdminCode);
            document.getElementById('adminCodeInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    checkAdminCode();
                }
            });
        });
        
        // Switch between tabs
        function switchTab(tabNumber) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content and mark tab as active
            document.getElementById(`tabContent${tabNumber}`).classList.add('active');
            document.getElementById(`tab${tabNumber}`).classList.add('active');
        }
        
        // Fetch data from Google Sheets
        async function fetchData() {
            try {
                const response = await fetch(`${API_URL}?sheetId=${SHEET_ID}&sheetName=${SHEET_NAME}`);
                const data = await response.json();
                
                if (data && data.length > 0) {
                    allData = data;
                    
                    // Extract all dates and normalize their format
                    extractAllDates();
                    
                    // Set min/max for date pickers and set default values
                    setDatePickerMinMax();

                    // Populate daily table (this still uses allDates)
                    populateDailyTable();
                }
            } catch (error) {
                console.error('Error fetching data:', error);
                displayMessageBox('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'error');
            }
        }
        
        // Extract all dates from the data
        function extractAllDates() {
            allDates = [];
            
            // Extract unique dates from the data (starting from column 3)
            if (allData.length > 0 && allData[0].length > 2) {
                for (let i = 2; i < allData[0].length; i++) {
                    const normalizedDate = normalizeDateString(allData[0][i]);
                    if (normalizedDate) {
                        allDates.push({
                            date: normalizedDate, // Store normalized YYYY-MM-DD string
                            columnIndex: i,
                            formattedDate: formatDate(normalizedDate) // For display
                        });
                    }
                }
            }
            
            // Sort dates in descending order (newest first)
            allDates.sort((a, b) => new Date(b.date) - new Date(a.date));
        }

        // Set min/max attributes for date pickers and set default values
        function setDatePickerMinMax() {
            if (allDates.length > 0) {
                // The dates in allDates are already sorted from newest to oldest
                const newestDate = allDates[0].date; // YYYY-MM-DD
                const oldestDate = allDates[allDates.length - 1].date; // YYYY-MM-DD

                const dateSelector = document.getElementById('dateSelector');
                dateSelector.min = oldestDate;
                dateSelector.max = newestDate;
                dateSelector.value = newestDate; // Set default to the newest date
                handleDateSelection(); // Trigger initial load for the newest date

                const startDateSelector = document.getElementById('startDateSelector');
                const endDateSelector = document.getElementById('endDateSelector');
                startDateSelector.min = oldestDate;
                startDateSelector.max = newestDate;
                endDateSelector.min = oldestDate;
                endDateSelector.max = newestDate;
                // Set default range to the newest date
                startDateSelector.value = newestDate;
                endDateSelector.value = newestDate;
            }
            // Hide loader after setting up date pickers
            document.getElementById('dailyStatsLoader').style.display = 'none';
        }
        
        // Handle date selection change for daily stats tab
        function handleDateSelection() {
            const selectedDate = document.getElementById('dateSelector').value; // Value is YYYY-MM-DD
            currentSelectedDate = selectedDate;
            
            if (selectedDate) {
                document.getElementById('dailyStatsLoader').style.display = 'block';
                document.getElementById('dailyStatsContent').classList.add('hidden');
                document.getElementById('adminContentArea').classList.add('hidden');
                document.getElementById('adminCodeInput').value = '';
                
                setTimeout(() => {
                    updateDailyStats(selectedDate);
                    document.getElementById('dailyStatsLoader').style.display = 'none';
                    document.getElementById('dailyStatsContent').classList.remove('hidden');
                    document.getElementById('selectedDateDisplay').textContent = formatDate(selectedDate);
                }, 500);
            } else {
                document.getElementById('dailyStatsContent').classList.add('hidden');
            }
        }
        
        // Update daily statistics based on selected date
        function updateDailyStats(selectedDate) {
            // Find the column index for the selected date
            let dateColumnIndex = -1;
            
            for (let i = 2; i < allData[0].length; i++) {
                // Compare selectedDate (YYYY-MM-DD) with the normalized date in the header row
                if (normalizeDateString(allData[0][i]) === selectedDate) {
                    dateColumnIndex = i;
                    break;
                }
            }
            
            if (dateColumnIndex === -1) {
                // If date not found, clear content or show a message
                document.getElementById('presentCount').textContent = 0;
                document.getElementById('lateCount').textContent = 0;
                document.getElementById('personalLeaveCount').textContent = 0;
                document.getElementById('sickLeaveCount').textContent = 0;
                document.getElementById('absentCount').textContent = 0;
                document.getElementById('officialCount').textContent = 0;
                document.getElementById('totalCount').textContent = 0;
                if (dailyChart) {
                    dailyChart.destroy(); // Clear chart if no data
                }
                displayMessageBox('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å', 'info');
                return;
            }
            
            // Count statuses
            const statusCounts = {
                '‡∏°‡∏≤': 0,
                '‡∏™‡∏≤‡∏¢': 0,
                '‡∏•‡∏≤‡∏Å‡∏¥‡∏à': 0,
                '‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢': 0,
                '‡∏Ç‡∏≤‡∏î': 0,
                '‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£': 0
            };
            
            let totalCount = 0;
            
            // Start from row 1 (skip header)
            for (let i = 1; i < allData.length; i++) {
                if (allData[i][dateColumnIndex]) {
                    const status = allData[i][dateColumnIndex];
                    if (statusCounts.hasOwnProperty(status)) {
                        statusCounts[status]++;
                    }
                    totalCount++;
                }
            }
            
            // Update the counts in the UI
            document.getElementById('presentCount').textContent = statusCounts['‡∏°‡∏≤'];
            document.getElementById('lateCount').textContent = statusCounts['‡∏™‡∏≤‡∏¢'];
            document.getElementById('personalLeaveCount').textContent = statusCounts['‡∏•‡∏≤‡∏Å‡∏¥‡∏à'];
            document.getElementById('sickLeaveCount').textContent = statusCounts['‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢'];
            document.getElementById('absentCount').textContent = statusCounts['‡∏Ç‡∏≤‡∏î'];
            document.getElementById('officialCount').textContent = statusCounts['‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£'];
            document.getElementById('totalCount').textContent = totalCount;
            
            // Update the chart
            updateDailyChart(statusCounts);
        }
        
        // Update the daily chart
        function updateDailyChart(statusCounts) {
            const ctx = document.getElementById('dailyChart').getContext('2d');
            
            // Destroy previous chart if it exists
            if (dailyChart) {
                dailyChart.destroy();
            }
            
            // Create new chart
            dailyChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['‡∏°‡∏≤', '‡∏™‡∏≤‡∏¢', '‡∏•‡∏≤‡∏Å‡∏¥‡∏à', '‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢', '‡∏Ç‡∏≤‡∏î', '‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£'],
                    datasets: [{
                        data: [
                            statusCounts['‡∏°‡∏≤'],
                            statusCounts['‡∏™‡∏≤‡∏¢'],
                            statusCounts['‡∏•‡∏≤‡∏Å‡∏¥‡∏à'],
                            statusCounts['‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢'],
                            statusCounts['‡∏Ç‡∏≤‡∏î'],
                            statusCounts['‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£']
                        ],
                        backgroundColor: chartColors,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        title: {
                            display: true,
                            text: '‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏°‡∏≤‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô',
                            font: {
                                size: 16
                            }
                        }
                    }
                }
            });
        }
        
        // Check admin code for special access
        function checkAdminCode() {
            const inputCode = document.getElementById('adminCodeInput').value.trim();
            const adminContentArea = document.getElementById('adminContentArea');
            
            if (inputCode === ADMIN_CODE) {
                if (currentSelectedDate) {
                    showSpecialStatusStaff(currentSelectedDate);
                    adminContentArea.classList.remove('hidden');
                    adminContentArea.classList.add('fade-in');
                } else {
                    displayMessageBox('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡πà‡∏≠‡∏ô', 'warning');
                }
            } else {
                adminContentArea.classList.add('hidden');
                displayMessageBox('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
            }
        }
        
        // Show staff with special status (not present)
        function showSpecialStatusStaff(selectedDate) {
            // Find the column index for the selected date
            let dateColumnIndex = -1;
            
            for (let i = 2; i < allData[0].length; i++) {
                if (normalizeDateString(allData[0][i]) === selectedDate) {
                    dateColumnIndex = i;
                    break;
                }
            }
            
            if (dateColumnIndex === -1) return;
            
            const tableBody = document.getElementById('specialStatusTableBody');
            tableBody.innerHTML = '';
            
            // Special statuses to show (all except "‡∏°‡∏≤")
            const specialStatuses = ['‡∏™‡∏≤‡∏¢', '‡∏•‡∏≤‡∏Å‡∏¥‡∏à', '‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢', '‡∏Ç‡∏≤‡∏î', '‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£'];
            
            // Start from row 1 (skip header)
            for (let i = 1; i < allData.length; i++) {
                if (allData[i][dateColumnIndex] && specialStatuses.includes(allData[i][dateColumnIndex])) {
                    const staffId = allData[i][0];
                    const staffName = allData[i][1];
                    const status = allData[i][dateColumnIndex];
                    
                    const row = document.createElement('tr');
                    
                    let statusClass = '';
                    if (statusColors.hasOwnProperty(status)) {
                        statusClass = statusColors[status];
                    }
                    
                    row.innerHTML = `
                        <td>${staffId}</td>
                        <td>${staffName}</td>
                        <td>
                            <span class="status-badge ${statusClass}">
                                ${status}
                            </span>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                }
            }
            
            // If no staff with special status
            if (tableBody.children.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="3" class="text-center py-4 text-gray-500">
                        ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
                    </td>
                `;
                tableBody.appendChild(row);
            }
        }
        
        // Populate daily statistics table
        function populateDailyTable() {
            document.getElementById('dailyTableLoader').style.display = 'block';
            
            setTimeout(() => {
                const tableBody = document.getElementById('dailyTableBody');
                tableBody.innerHTML = '';
                
                // Process each date
                allDates.forEach(dateObj => {
                    const { date, columnIndex } = dateObj; // date is already normalized YYYY-MM-DD
                    
                    // Count statuses for this date
                    const statusCounts = {
                        '‡∏°‡∏≤': 0,
                        '‡∏™‡∏≤‡∏¢': 0,
                        '‡∏•‡∏≤‡∏Å‡∏¥‡∏à': 0,
                        '‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢': 0,
                        '‡∏Ç‡∏≤‡∏î': 0,
                        '‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£': 0
                    };
                    
                    let totalCount = 0;
                    
                    // Start from row 1 (skip header)
                    for (let i = 1; i < allData.length; i++) {
                        if (allData[i][columnIndex]) {
                            const status = allData[i][columnIndex];
                            if (statusCounts.hasOwnProperty(status)) {
                                statusCounts[status]++;
                            }
                            totalCount++;
                        }
                    }
                    
                    // Create table row
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${formatDate(date)}</td>
                        <td>${statusCounts['‡∏°‡∏≤']}</td>
                        <td>${statusCounts['‡∏™‡∏≤‡∏¢']}</td>
                        <td>${statusCounts['‡∏•‡∏≤‡∏Å‡∏¥‡∏à']}</td>
                        <td>${statusCounts['‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢']}</td>
                        <td>${statusCounts['‡∏Ç‡∏≤‡∏î']}</td>
                        <td>${statusCounts['‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£']}</td>
                        <td class="font-semibold">${totalCount}</td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                document.getElementById('dailyTableLoader').style.display = 'none';
                document.getElementById('dailyTableContent').classList.remove('hidden');
            }, 500);
        }
        
        // Search for staff by ID
        function searchStaffId() {
            const staffId = document.getElementById('staffIdInput').value.trim();
            
            if (!staffId) {
                displayMessageBox('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏ ID ‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£', 'warning');
                return;
            }
            
            document.getElementById('staffIdLoader').classList.remove('hidden');
            document.getElementById('staffInfoContent').classList.add('hidden');
            document.getElementById('staffStatsContent').classList.add('hidden');
            document.getElementById('staffNotFound').classList.add('hidden');
            
            setTimeout(() => {
                // Find the staff in the data
                currentStaffRowIndex = -1;
                
                for (let i = 1; i < allData.length; i++) {
                    if (allData[i][0] && allData[i][0].toString() === staffId) {
                        currentStaffRowIndex = i;
                        break;
                    }
                }
                
                if (currentStaffRowIndex === -1) {
                    // Staff not found
                    document.getElementById('staffIdLoader').classList.add('hidden');
                    document.getElementById('staffNotFound').classList.remove('hidden');
                    return;
                }
                
                // Display staff information
                document.getElementById('staffId').textContent = allData[currentStaffRowIndex][0];
                document.getElementById('staffName').textContent = allData[currentStaffRowIndex][1];
                
                // Ensure date range selectors are reset to the newest date for new staff search
                const startDateSelector = document.getElementById('startDateSelector');
                const endDateSelector = document.getElementById('endDateSelector');
                if (allDates.length > 0) {
                    startDateSelector.value = allDates[0].date;
                    endDateSelector.value = allDates[0].date;
                }
                
                document.getElementById('staffIdLoader').classList.add('hidden');
                document.getElementById('staffInfoContent').classList.remove('hidden');
            }, 500);
        }
        
        // Search for staff data within date range
        function searchDateRange() {
            const startDate = document.getElementById('startDateSelector').value; // Value is YYYY-MM-DD
            const endDate = document.getElementById('endDateSelector').value;     // Value is YYYY-MM-DD
            
            if (!startDate || !endDate) {
                displayMessageBox('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î', 'warning');
                return;
            }
            
            if (currentStaffRowIndex === -1) {
                displayMessageBox('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ID ‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏Å‡πà‡∏≠‡∏ô', 'warning');
                return;
            }

            // Validate date range
            // Direct string comparison works for YYYY-MM-DD for chronological order
            if (startDate > endDate) {
                displayMessageBox('‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î', 'error');
                return;
            }
            
            document.getElementById('staffStatsLoader').classList.remove('hidden');
            document.getElementById('staffStatsContent').classList.add('hidden');
            
            setTimeout(() => {
                // Find date indices within range
                const dateIndicesInRange = [];
                
                for (let i = 2; i < allData[0].length; i++) {
                    const currentDateInSheet = normalizeDateString(allData[0][i]); // Normalize sheet date
                    
                    if (currentDateInSheet && currentDateInSheet >= startDate && currentDateInSheet <= endDate) {
                        dateIndicesInRange.push({
                            date: currentDateInSheet,
                            columnIndex: i
                        });
                    }
                }
                
                // Sort dates in descending order (newest first)
                dateIndicesInRange.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                // Populate staff attendance table
                const tableBody = document.getElementById('staffTableBody');
                tableBody.innerHTML = '';
                
                // Status counts
                const statusCounts = {
                    '‡∏°‡∏≤': 0,
                    '‡∏™‡∏≤‡∏¢': 0,
                    '‡∏•‡∏≤‡∏Å‡∏¥‡∏à': 0,
                    '‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢': 0,
                    '‡∏Ç‡∏≤‡∏î': 0,
                    '‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£': 0
                };
                
                // Process each date in range
                dateIndicesInRange.forEach(dateObj => {
                    const { date, columnIndex } = dateObj;
                    const status = allData[currentStaffRowIndex][columnIndex] || '-';
                    
                    // Update status counts
                    if (statusCounts.hasOwnProperty(status)) {
                        statusCounts[status]++;
                    }
                    
                    // Create table row
                    const row = document.createElement('tr');
                    
                    let statusClass = '';
                    if (statusColors.hasOwnProperty(status)) {
                        statusClass = statusColors[status];
                    }
                    
                    row.innerHTML = `
                        <td>${formatDate(date)}</td>
                        <td>
                            <span class="status-badge ${statusClass}">
                                ${status}
                            </span>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                // If no dates in range
                if (tableBody.children.length === 0) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td colspan="2" class="text-center py-4 text-gray-500">
                            ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
                        </td>
                    `;
                    tableBody.appendChild(row);
                }
                
                // Update status counts in UI
                document.getElementById('staffPresentCount').textContent = statusCounts['‡∏°‡∏≤'];
                document.getElementById('staffLateCount').textContent = statusCounts['‡∏™‡∏≤‡∏¢'];
                document.getElementById('staffPersonalLeaveCount').textContent = statusCounts['‡∏•‡∏≤‡∏Å‡∏¥‡∏à'];
                document.getElementById('staffSickLeaveCount').textContent = statusCounts['‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢'];
                document.getElementById('staffAbsentCount').textContent = statusCounts['‡∏Ç‡∏≤‡∏î'];
                document.getElementById('staffOfficialCount').textContent = statusCounts['‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£'];
                
                // Update date range display
                document.getElementById('dateRangeDisplay').textContent = 
                    `${formatDate(startDate)} ‡∏ñ‡∏∂‡∏á ${formatDate(endDate)}`;
                
                document.getElementById('staffStatsLoader').classList.add('hidden');
                document.getElementById('staffStatsContent').classList.remove('hidden');
            }, 500);
        }
        
        // Format date to Thai format
        function formatDate(dateStr) {
            try {
                const date = new Date(dateStr);
                // Ensure the date is valid before formatting
                if (isNaN(date.getTime())) {
                    return dateStr; // Return original string if invalid date
                }
                return date.toLocaleDateString('th-TH', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            } catch (e) {
                console.error("Error formatting date:", e);
                return dateStr;
            }
        }

        // Custom message box function (replaces alert())
        function displayMessageBox(message, type = 'info') {
            let messageBox = document.getElementById('customMessageBox');
            if (!messageBox) {
                messageBox = document.createElement('div');
                messageBox.id = 'customMessageBox';
                messageBox.className = 'message-box-overlay hidden'; // Initially hidden
                messageBox.innerHTML = `
                    <div class="message-box-content">
                        <p id="messageBoxText" class="message-box-text"></p>
                        <button id="messageBoxCloseBtn" class="message-box-close-btn">
                            ‡∏ï‡∏Å‡∏•‡∏á
                        </button>
                    </div>
                `;
                document.body.appendChild(messageBox);
                document.getElementById('messageBoxCloseBtn').addEventListener('click', () => {
                    messageBox.classList.add('hidden');
                });
            }

            const messageBoxText = document.getElementById('messageBoxText');
            messageBoxText.textContent = message;

            // Optional: Change color based on message type
            messageBoxText.className = 'message-box-text'; // Reset classes
            if (type === 'error') {
                messageBoxText.classList.add('text-red-700');
            } else if (type === 'warning') {
                messageBoxText.classList.add('text-yellow-700');
            } else {
                messageBoxText.classList.add('text-gray-800');
            }

            messageBox.classList.remove('hidden');
        }
    </script>
</body>
</html>
